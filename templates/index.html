<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Voice Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/2.0.0/modern-normalize.min.css" integrity="sha512-F0bnVpkgN1lZ8ljv7weZDJcVEg6L38tnSuwRt+Y9BAnQCK9gI0gbrUWId+jpj52aqEidkmu3Pvb5xKM5M0xX8w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body { background:#f6f8fa;font-family:Arial, sans-serif;margin:0;padding:0; }
        #root { max-width:800px;margin:40px auto;padding:0 20px; }
        .chat-box { border:1px solid #ddd;border-radius:8px;overflow:hidden; }
        .messages { background:#fff;height:60vh;overflow-y:auto;padding:20px; }
        .message { margin-bottom:10px; }
        .message.user { text-align:right;color:#333; }
        .message.ai { text-align:left;color:#444; }
        .input-area { display:flex;border-top:1px solid #ddd; }
        .input-area input { flex:1;padding:15px;border:none;font-size:1em; }
        .input-area button { padding:15px 20px;background:#2f80ed;color:#fff;border:none;font-size:1em;cursor:pointer; }
    </style>
</head>
<body>
<div id="root"></div>
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script type="text/babel">
function ChatApp(){
  const [messages, setMessages] = React.useState([]);

  React.useEffect(() => {
    fetch('/history').then(r=>r.json()).then(data=>{
      setMessages(data);
      setTimeout(()=>{ scrollBottom(); }, 100);
    });
  }, []);

  const scrollBottom = () => {
    const el = document.getElementById('messages');
    if(el) el.scrollTop = el.scrollHeight;
  };

  const send = () => {
    const input = document.getElementById('input');
    const text = input.value.trim();
    if(!text) return;
    setMessages(prev => [...prev, {type:'user', content:text}]);
    input.value='';
    fetch('/chat', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message:text})
    }).then(r=>r.json()).then(data=>{
      setMessages(prev => [...prev, {type:'ai', content:data.response}]);
      scrollBottom();
    });
  };

  return (
    <div className="chat-box">
      <div className="messages" id="messages">
        {messages.map((m,i)=>(<div key={i} className={`message ${m.type}`}>{m.content}</div>))}
      </div>
      <div className="input-area">
        <input id="input" type="text" placeholder="Ask something..." autoComplete="off" onKeyDown={e=>e.key==='Enter'&&send()}/>
        <button onClick={send}>Send</button>
      </div>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<ChatApp/>);
</script>
</body>
</html>
